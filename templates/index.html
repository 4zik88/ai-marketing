<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Marketing - Web App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 0;
        }
        .feature-card {
            transition: transform 0.3s ease;
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .loading {
            display: none;
        }
        .result-section {
            display: none;
        }
        .ai-provider-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .ai-provider-card:hover {
            transform: scale(1.02);
        }
        .ai-provider-card.selected {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        .free-badge {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        .premium-badge {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
        }
        .card-title,
        .form-check-label {
            color: #000;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold mb-4">AI Marketing</h1>
                    <p class="lead mb-4">Automatically generate Google Ads campaigns using FAB methodology and AI</p>
                    <div class="d-flex gap-3">
                        <span class="badge bg-light text-dark fs-6"><i class="fas fa-check"></i> Free AI Models</span>
                        <span class="badge bg-light text-dark fs-6"><i class="fas fa-check"></i> FAB Analysis</span>
                        <span class="badge bg-light text-dark fs-6"><i class="fas fa-check"></i> Excel Export</span>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Start Analysis</h5>
                            <form id="analysisForm">
                                <div class="mb-3">
                                    <label for="websiteUrl" class="form-label">Website URL</label>
                                    <input type="url" class="form-control" id="websiteUrl" 
                                           placeholder="https://example.com" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">AI Provider</label>
                                    <div id="aiProviders" class="row g-2">
                                        <!-- AI providers will be loaded here -->
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="aiModel" class="form-label">AI Model</label>
                                    <select class="form-select" id="aiModel" required>
                                        <option value="gemini-2.0-flash">Gemini 2.0 Flash (Default)</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="keywordsOnly">
                                    <label class="form-check-label" for="keywordsOnly">
                                        Generate keywords only
                                    </label>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-magic"></i> Analyze Website
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Section -->
    <div class="loading text-center py-5">
        <div class="container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h4 class="mt-3">Analyzing website...</h4>
            <p class="text-muted">This may take 1-2 minutes depending on the AI provider</p>
        </div>
    </div>

    <!-- Results Section -->
    <div class="result-section">
        <div class="container py-5">
            <div class="row">
                <div class="col-lg-8">
                    <!-- Website Info -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-globe"></i> Website Information</h5>
                        </div>
                        <div class="card-body" id="websiteInfo">
                            <!-- Website info will be loaded here -->
                        </div>
                    </div>

                    <!-- FAB Analysis -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-lightbulb"></i> FAB Analysis</h5>
                        </div>
                        <div class="card-body" id="fabAnalysis">
                            <!-- FAB analysis will be loaded here -->
                        </div>
                    </div>

                    <!-- Google Ads Preview -->
                    <div class="card mb-4" id="adsPreview" style="display: none;">
                        <div class="card-header">
                            <h5><i class="fas fa-bullhorn"></i> Google Ads Preview</h5>
                        </div>
                        <div class="card-body" id="adsContent">
                            <!-- Ads preview will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- Download Section -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-download"></i> Download Results</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted">Download your analysis results as Excel file</p>
                            <button class="btn btn-success w-100" id="downloadBtn">
                                <i class="fas fa-file-excel"></i> Download Excel
                            </button>
                        </div>
                    </div>

                    <!-- Keywords Summary -->
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-key"></i> Keywords Summary</h5>
                        </div>
                        <div class="card-body" id="keywordsSummary">
                            <!-- Keywords summary will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="container py-5">
        <h2 class="text-center mb-5">Features</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-search fa-3x text-primary mb-3"></i>
                        <h5>Website Parsing</h5>
                        <p class="text-muted">Automatically extract content, meta tags, and structure from any website</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-brain fa-3x text-success mb-3"></i>
                        <h5>FAB Analysis</h5>
                        <p class="text-muted">Apply Features-Advantages-Benefits methodology using AI to create compelling offers</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-bullhorn fa-3x text-warning mb-3"></i>
                        <h5>Google Ads</h5>
                        <p class="text-muted">Generate ready-to-use Google Ads campaigns with proper character limits</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4">
        <div class="container text-center">
            <p>&copy; 2024 AI Marketing by <a href="https://t.me/" target="_blank">Viacheslav Tykhenkyi</a>. Built with Flask and AI.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentSessionId = null;
        let currentDownloadFile = null;

        // Load AI providers on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAIProviders();
        });

        async function loadAIProviders() {
            try {
                // Load providers and config in parallel
                const [providersResponse, configResponse] = await Promise.all([
                    fetch('/api/ai-providers'),
                    fetch('/api/config')
                ]);
                const providers = await providersResponse.json();
                const config = await configResponse.json();

                const container = document.getElementById('aiProviders');
                container.innerHTML = '';

                Object.entries(providers).forEach(([key, provider]) => {
                    const col = document.createElement('div');
                    col.className = 'col-6 col-md-4';

                    const badgeClass = provider.free ? 'free-badge' : 'premium-badge';
                    const badgeText = provider.free ? 'FREE' : 'PAID';

                    col.innerHTML = `
                        <div class="card ai-provider-card h-100" data-provider="${key}">
                            <div class="card-body text-center p-2">
                                <h6 class="card-title">${provider.name}</h6>
                                <span class="badge ${badgeClass}">${badgeText}</span>
                                <p class="card-text small text-muted">${provider.description}</p>
                            </div>
                        </div>
                    `;

                    col.addEventListener('click', () => selectAIProvider(key, provider));
                    container.appendChild(col);
                });

                // Select provider from config (default settings)
                const defaultProvider = config.ai_provider || 'google';
                const defaultModel = config.ai_model || 'gemini-2.0-flash';

                if (providers[defaultProvider]) {
                    selectAIProvider(defaultProvider, providers[defaultProvider], defaultModel);
                } else {
                    selectAIProvider('google', providers['google']);
                }

            } catch (error) {
                console.error('Error loading AI providers:', error);
            }
        }

        function selectAIProvider(providerKey, provider, defaultModel = null) {
            // Remove selected class from all cards
            document.querySelectorAll('.ai-provider-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selected class to clicked card
            document.querySelector(`[data-provider="${providerKey}"]`).classList.add('selected');

            // Update model dropdown
            const modelSelect = document.getElementById('aiModel');
            modelSelect.innerHTML = '';

            provider.models.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                if (defaultModel && model === defaultModel) {
                    option.selected = true;
                }
                modelSelect.appendChild(option);
            });
        }

        // Handle form submission
        document.getElementById('analysisForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const url = document.getElementById('websiteUrl').value;
            const selectedProvider = document.querySelector('.ai-provider-card.selected');
            const provider = selectedProvider ? selectedProvider.dataset.provider : 'google';
            const model = document.getElementById('aiModel').value;
            const keywordsOnly = document.getElementById('keywordsOnly').checked;
            
            // Show loading
            document.querySelector('.loading').style.display = 'block';
            document.querySelector('.result-section').style.display = 'none';
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: url,
                        ai_provider: provider,
                        ai_model: model,
                        keywords_only: keywordsOnly
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentSessionId = result.session_id;
                    currentDownloadFile = result.download_file;
                    
                    displayResults(result);
                } else {
                    throw new Error(result.error || 'Analysis failed');
                }
                
            } catch (error) {
                alert('Error: ' + error.message);
                console.error('Analysis error:', error);
            } finally {
                document.querySelector('.loading').style.display = 'none';
            }
        });

        function displayResults(result) {
            // Display website info
            const websiteInfo = document.getElementById('websiteInfo');
            websiteInfo.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <strong>URL:</strong> ${result.website_data.url}<br>
                        <strong>Domain:</strong> ${result.website_data.domain}<br>
                        <strong>Title:</strong> ${result.website_data.title}
                    </div>
                    <div class="col-md-6">
                        <strong>Description:</strong> ${result.website_data.description}<br>
                        <strong>H1 Tags:</strong> ${result.website_data.headings.h1?.length || 0}
                    </div>
                </div>
            `;
            
            // Display FAB analysis
            const fabAnalysis = document.getElementById('fabAnalysis');
            fabAnalysis.innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <h6>Product Name</h6>
                        <p>${result.fab_analysis.product_name || 'N/A'}</p>
                    </div>
                    <div class="col-md-4">
                        <h6>Target Audience</h6>
                        <p>${result.fab_analysis.target_audience || 'N/A'}</p>
                    </div>
                    <div class="col-md-4">
                        <h6>Unique Value</h6>
                        <p>${result.fab_analysis.unique_value_proposition || 'N/A'}</p>
                    </div>
                </div>
                <hr>
                <h6>FAB Statements</h6>
                <div class="row">
                    ${result.fab_analysis.fab_statements?.slice(0, 3).map(stmt => `
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">${stmt.benefit}</h6>
                                    <p class="card-text small">${stmt.advantage}</p>
                                    <p class="card-text small text-muted">${stmt.feature}</p>
                                </div>
                            </div>
                        </div>
                    `).join('') || '<p>No FAB statements generated</p>'}
                </div>
            `;
            
            // Display ads preview if available
            if (result.type === 'complete' && result.ads_data?.ads) {
                const adsPreview = document.getElementById('adsPreview');
                const adsContent = document.getElementById('adsContent');
                
                adsContent.innerHTML = `
                    <div class="row">
                        ${result.ads_data.ads.slice(0, 2).map(ad => `
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-header">
                                        <h6>${ad.type}</h6>
                                    </div>
                                    <div class="card-body">
                                        <strong>Headlines:</strong>
                                        <ul class="small">
                                            ${ad.headlines?.slice(0, 2).map(h => `<li>${h}</li>`).join('') || '<li>No headlines</li>'}
                                        </ul>
                                        <strong>Descriptions:</strong>
                                        <ul class="small">
                                            ${ad.descriptions?.slice(0, 1).map(d => `<li>${d}</li>`).join('') || '<li>No descriptions</li>'}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                adsPreview.style.display = 'block';
            }
            
            // Display keywords summary
            const keywordsSummary = document.getElementById('keywordsSummary');
            const keywords = result.keywords_data?.keywords || [];
            keywordsSummary.innerHTML = `
                <p><strong>Total Keywords:</strong> ${keywords.length}</p>
                <div class="small" id="keywordsPreview">
                    ${keywords.slice(0, 10).map(kw => {
                        const keyword = typeof kw === 'string' ? kw : kw.keyword || kw;
                        return `<span class="badge bg-secondary me-1 mb-1">${keyword}</span>`;
                    }).join('')}
                    ${keywords.length > 10 ? `<br><small class="text-muted">...and ${keywords.length - 10} more</small>` : ''}
                </div>
                ${keywords.length > 10 ? `
                    <button class="btn btn-sm btn-outline-primary mt-2" onclick="toggleAllKeywords()">
                        <i class="fas fa-eye"></i> Show All Keywords
                    </button>
                ` : ''}
                <div id="allKeywords" style="display: none;" class="mt-3">
                    <h6>All Keywords:</h6>
                    <div class="small">
                        ${keywords.map(kw => {
                            const keyword = typeof kw === 'string' ? kw : kw.keyword || kw;
                            const matchType = typeof kw === 'object' ? kw.match_type || 'broad' : 'broad';
                            const volume = typeof kw === 'object' ? kw.search_volume || 'medium' : 'medium';
                            return `<span class="badge bg-secondary me-1 mb-1" title="Match: ${matchType}, Volume: ${volume}">${keyword}</span>`;
                        }).join('')}
                    </div>
                    <button class="btn btn-sm btn-outline-secondary mt-2" onclick="toggleAllKeywords()">
                        <i class="fas fa-eye-slash"></i> Hide All Keywords
                    </button>
                </div>
            `;
            
            // Show results section
            document.querySelector('.result-section').style.display = 'block';
        }

        // Handle download
        document.getElementById('downloadBtn').addEventListener('click', function() {
            if (currentDownloadFile) {
                window.open(`/api/download/${currentDownloadFile}`, '_blank');
            } else {
                alert('No file available for download');
            }
        });

        // Toggle keywords display
        function toggleAllKeywords() {
            const allKeywordsDiv = document.getElementById('allKeywords');
            const previewDiv = document.getElementById('keywordsPreview');
            
            if (allKeywordsDiv.style.display === 'none') {
                allKeywordsDiv.style.display = 'block';
                previewDiv.style.display = 'none';
            } else {
                allKeywordsDiv.style.display = 'none';
                previewDiv.style.display = 'block';
            }
        }
    </script>
</body>
</html>
